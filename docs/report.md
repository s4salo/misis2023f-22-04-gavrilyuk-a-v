# Реляционные базы данных
## Введение
Данные - это записи, факты, идеи, зафиксированные в формализованном виде — таком, который позволяет хранить, передавать и обрабатывать их.</br>
База данных - это организованная по некоторому принципу совокупность данных из какой-либо области знаний.</br>
Принцип построения базы данных определяется ее моделью. 

## Реляционная модель
<img align="left" width="400" alt="image" src="https://github.com/s4salo/misis2023f-22-04-gavrilyuk-a-v/assets/127080534/dc12a6e1-6e36-4c70-bb89-53373b5177e6"> 
Реляционная модель - это интуитивно понятный, наглядный табличный способ представления данных. Каждая строка, содержащаяся в таблице такой базы данных, представляет собой запись с уникальным идентификатором, который называют ключом. Столбцы таблицы имеют атрибуты данных, а каждая запись обычно содержит значение для каждого атрибута, что дает возможность устанавливать взаимосвязь между элементами данных.
Реляционную модель предложил британский математик Эдгар Кодд на рубеже шестидесятых и семидесятых годов XX в.<br/>

## Реляционная база данных
Реляционная база данных — это составленная по реляционной модели база данных, в которой данные, занесенные в таблицы, имеют изначально заданные отношения. Сами таблицы в такой базе данных также соотносятся друг с другом строго определенным образом.

Для взаимодействия с любой реляционной базой данных используется SQL (Structured Query Language) — язык структурированных запросов. Это основа интерфейса систем управления базами данных. Он включает в себя такие операции, как создание таблиц (CREATE TABLE), вставка данных (INSERT), обновление данных (UPDATE), удаление данных (DELETE) и получение данных (SELECT).

## Нормальные формы баз данных
Нормализация — это процесс организации данных в базе для сокращения избыточности и улучшения целостности. Она включает разбиение больших таблиц на более мелкие, связанные таблицы и определение отношений между ними. Это упрощает обслуживание базы данных и уменьшает вероятность возникновения ошибок. Нормализация обычно выполняется до третьей нормальной формы (3NF), хотя существуют и более высокие уровни нормализации — до шестой нормальной формы (6NF).
Вот некоторые из нормальных форм:
* 1НФ - запрещает хранить многоатомные атрибуты, требует разбиения их на отдельные одноатомные.
* 2НФ - исключает зависимость неключевых атрибутов от части ключа.
* 3НФ - устраняет зависимость неключевых атрибутов от других неключевых.</br>
Нормализация до высоких уровней может понизить производительность базы данных.

## Соединения таблиц
Для того, чтобы получить наиболее полную информацию от нормализованной базы данных, нужно соединять данные из разных таблиц на основе некоторого условия. <br/><br/>
<img align="left" width="400" alt="image" src="https://github.com/s4salo/misis2023f-22-04-gavrilyuk-a-v/assets/127080534/06e85032-81cf-4037-99e7-db11c1fa99ba">
Существует несколько типов соединений:
* INNER JOIN: возвращает только те строки, для которых условие соединения выполняется. То есть, только строки, которые имеют соответствующие значения в обеих таблицах, будут включены в результат.
* LEFT JOIN: возвращает все строки из левой таблицы и соответствующие строки из правой таблицы. Если для строки в левой таблице нет соответствующей строки в правой таблице, то в результирующем наборе будут присутствовать NULL-значения для столбцов правой таблицы.
* RIGHT JOIN: возвращает все строки из правой таблицы и соответствующие строки из левой таблицы. Если для строки в правой таблице нет соответствующей строки в левой таблице, то в результирующем наборе будут присутствовать NULL-значения для столбцов левой таблицы.
* FULL JOIN: возвращает все строки из обеих таблиц. Если для строки в одной таблице нет соответствующей строки в другой таблице, то в результирующем наборе будут присутствовать NULL-значения для соответствующих столбцов.
* CROSS JOIN: производит комбинаторное сочетание всех строк из двух таблиц. Результатом является декартово произведение строк, то есть каждая строка из первой таблицы будет сочетаться со всеми строками из второй таблицы.

# Подробнее об SQL
## Управление данными
Основными операциями управления данными в SQL являются
* SELECT - извлечение данных из одной или нескольких таблиц с условиями фильтрации и сортировки
* INSERT - добавление новой записи в таблицу.
* UPDATE - изменение данных существующей записи.
* DELETE - удаление записи.

Фильтрация и сортировка данных реализуются с помощью соответствующих ключевых слов - WHERE и ORDER BY. Агрегатные функции такие как COUNT(), SUM(), AVG() и др. служат для суммирования и статистической обработки данных, используются в связке с GROUP BY. 
## Транзакции и принцип ACID
Транзакция — это комплекс последовательных операций с применением операторов SQL, имеющих определенную цель. Все транзакции должны отвечать четырем требованиям ___ACID___:

* Атомарность (англ. atomicity) — транзакция является неделимым блоком и выполняется или полностью, или никак.
* Согласованность (англ. consistency) — завершенная транзакция сохраняет согласованность базы данных.
* Изолированность (англ. isolation) — параллельные транзакции не могут влиять друг на друга.
* Устойчивость (англ. durability) — никакой сбой в системе не может влиять на результат завершенной транзакции.
Пример простой транзакции: 
``` sql
BEGIN TRANSACTION;
   -- Добавление нового заказа
   INSERT INTO Orders (OrderID, UserID, TotalAmount)
   VALUES (1, 123, 50.00);

   -- Обновление информации о пользователе
   UPDATE Users
   SET TotalOrders = TotalOrders + 1
   WHERE UserID = 123;

IF <условие_ошибки> THEN
    ROLLBACK;
ELSE
    COMMIT;

END IF;
```
___К каким эффектам может привести параллельная работа двух транзакций?___
* Потерянная запись:
   возникает, когда две или более транзакции одновременно изменяют одни и те же данные, и результат одной транзакции перезаписывается результатом другой. В результате одни изменения могут быть потеряны.
* Грязное чтение: это ситуация, при которой транзакция может читать данные, которые были изменены другой транзакцией, но ещё не фиксированы (не был выполнен COMMIT). Это означает, что если транзакция, изменившая эти данные, в конце концов откатится (ROLLBACK), то первая транзакция прочитала "грязные" данные, которые на самом деле не существуют в базе.
* Повторяемое чтение: это ситуация, когда другая транзакция изменяет данные между двумя чтениями одной и той же транзакции, так что последующее чтение возвращает другие данные. Дальнейшее построение отчета будет бессмысленным.
* Фантомное чтение: это ситуация, когда другая транзакция добавляет или удаляет поля из базы данных в момент времени между двумя чтениями другой транзакции.


___Уровни изоляции транзакций___<br/>

Уровни изоляции транзакций в SQL определяют, в какой мере одна транзакция должна быть изолирована от работы других транзакций.<br/>
Доступные уровни изоляции:

* READ UNCOMMITTED: Самый низкий уровень изоляции, при котором разрешены феномены потерянных записей и грязных чтений.
* READ COMMITTED: Запрещает грязное чтение, но по-прежнему допускает повторяемые чтения и фантомное чтение.
* REPEATABLE READ: Исключает возможность повторяемых чтений, но всё ещё допускает возможность фантомного чтения.
* SERIALIZABLE: Самый высокий уровень изоляции, исключающий все предыдущие феномены, но может привести к замедлению работы системы из-за блокировок.  
## Функции SQL
В SQL также существует возможность создания пользовательских функций. Пользовательские функции позволяют определить собственные операции, которые можно использовать в запросах и других частях SQL-кода.
``` sql
CREATE FUNCTION square_sum(a INT, b INT)
RETURNS INT
BEGIN
    DECLARE result INT;
    SET result = a * a + b * b;
    RETURN result;
END;
```
Это не только облегчает поддержку и управление кодом, делая его более читаемым, но и позволяет многократно использовать функцию в различных SQL запросах, таких как SELECT, UPDATE, INSERT или DELETE, а также в других функциях, процедурах и триггерах.

## Процедуры и триггеры
* Процедуры — это наборы SQL-инструкций, которые выполняются как единый блок. Они могут принимать параметры, возвращать результаты и использоваться для модуляризации и повторного использования кода.<br/>

* Триггеры — это специальные типы хранимых процедур, которые автоматически запускаются, когда происходят определенные события в базе данных, как, например, вставка, обновление или удаление записей.

Пример создания процедуры:
```sql
CREATE PROCEDURE procedure (IN param1 INT, OUT param2 INT)
BEGIN
  -- Тело процедуры с логикой работы
  SET param2 = param1 + 1;
END;
```
Пример создания триггера:
```sql
CREATE TRIGGER trigger AFTER INSERT ON Orders
FOR EACH ROW
BEGIN
   -- Каждый раз после добавления нового заказа
   UPDATE Users SET TotalOrders = TotalOrders + 1 WHERE UserID = NEW.UserID;
END;
```
# Заключение
Реляционная модель является одной из самых распространенных и популярных моделей хранения и обработки данных. Она отличается простотой, наглядностью представления информации и возможностью устанавливать отношения между объектами.
SQL - это язык для работы с любыми реляционными СУБД. Он позволяет создавать, изменять и запрашивать данные, а также определять более сложную бизнес-логику при помощи процедур, функций и триггеров.
Реляционная модель и SQL являются основой для проектирования и выполнения сложных задач хранения и анализа данных во многих приложениях. Это универсальный и гибкий подход к организации баз данных.

